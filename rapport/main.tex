\documentclass[french]{layout/Report}
\usepackage{layout/Report}
\usepackage{layout/ReportFrontPage}

\usepackage{pgf,tikz,textcomp}
\usepackage[section]{placeins}
\usepackage{romannum}
\usetikzlibrary{arrows}
\usepackage{mathtools}
\usepackage{array}
\usepackage{color}
\usepackage{graphicx}
\usepackage{todonotes}
\usepackage{enumitem}
\usepackage{MnSymbol}

\DeclarePairedDelimiter\abs{\lvert}{\rvert}%

\begin{document}

\pagenumbering{arabic}


\frontpage{Télécommande à 1 canal par infrarouge}
%-------------------------------------------------------------------------------
\section{Introduction}
Le but est de concevoir un système d'émission - réception infrarouge avec adressage
permettant d'enclencher et déclencher un relais optique.

%-------------------------------------------------------------------------------
\section{Structure générale et principe}

On a divisé le système en 5 étages avec des interfaces définies:

\begin{description}[leftmargin=!,labelwidth=4cm, labelindent=\parindent]
\item[Générateur de signal] Générerateur de salves de N pulses de durée de 100\si{\micro\second} avec une période de 1\si{\milli\second} espacées de 100\si{\milli\second}.
\item[LED driver] Sortie de puissance qui drive la LED IR.
\item[Récepteur] Récepteur IR avec amplification et filtrage. La sortie est le signal digital des pulses.
\item[Décodeur] Circuit logique de décodage du nombre de pulses. La sortie est un pulse d'environ 5 \si{\milli\second} pour chaque salve correcte reçue.
\item[Sortie] Circuit de détection d'interruption du signal avec commutation et du relais optique.
\end{description}

\begin{figure}[h]
\centering
\vspace{5mm}
\includegraphics[width=\textwidth]{fig/IRemote_schema_structure}
% \includegraphics[width=0.8\textwidth]{fig/schema_bloc}
\caption{Schéma bloc du système avec signaux}
\label{fig:schema_bloc}
\vspace{5mm}
\end{figure}

Le but de la structure choisie est de faciliter le développement et la testabilité
du sous-système.



%-------------------------------------------------------------------------------
\section{Notation et nomenclature}

\begin{center}
	\begin{tabular}{| c | l | l |}
		\hline
		$n_{pulse}$	& Nombre de pulses dans une salve (addressage) & $13$ \\ \hline
		$t_0$				& Durée high d'un pulse	& $\SI{0.1}{\milli\second}$	\\ \hline
		$T_0$				& Période des pulse	& $\SI{1.0}{\milli\second}$	\\ \hline
		$D_0$				& Duty cycle dans une salve & $10\%$	\\ \hline
		$\tau$			& Période des slaves	& $\SI{0.1}{\second}$\\ \hline
		$t_{miss}$  & &\\ \hline
		$t_{true}$  & Durée du pulse signal une salve correcte & \\ \hline
	\end{tabular}
\end{center}

\section{Dimensionnements}
\subsection{Signal}
Le nombre d'impulsions $n_{pulse}$ a été fixé arbitrairement à 13. La période et le duty-cycle des impulsions sont dictés par ce que la LED infrarouge peut supporter (c.f. \ref{subsec:LED_driver}).

\subsection{Générateur de signal}
Le générateur de signal génère dans OUTPUT des salves de $n_{pulses}$ à une période $\tau$ en active high tant que celui-ci est alimenté à 3V. Les pulses dans les salves ont une durée high $t_0$ et une période $T_0$. Le nombre de pulses et les durées ne sont pas garanties lorsque l'alimentation est retirée.

\begin{description}[leftmargin=!,labelwidth=3cm, labelindent=\parindent]
	\item[Pulse timer] Génère des impulsion à hautes fréquences tant qu'il n'est pas RESET. Il est formé d'un timer TLC555 en configuration bascule astable. Les dimensionnements sont fait selon le datasheet \cite{TLC555} avec une petite capacité pour la simplicité et la limitation de la consommation.
		\begin{equation*}
			\begin{cases}
				t_0 = 0.693(Rpa+Rpb)Cp \\
				T_0 = 0.693(Rpa+2Rpb)Cp \\
				Rpl	= \SI{1}{\kilo\ohm}
			\end{cases}
		\end{equation*}
	\item[Decounter] Compte le nombre de pulses reçu depuis son dernier RESET et maintient le RESET du pulse timer le bloquant ainsi lorsque $n_{pulse}$ pulses ont été reçu. Il est formé d'un compter HEF4526B \cite{HEF4526B}.
	\item[Burst timer] Réinitialise le decounter à une période $\tau$ pour recommencer une salve. Il est formé d'un timer TLC555 en configuration bascule astable. Les dimensionnements sont fait selon le datasheet \cite{TLC555} avec une petite capacité pour la simplicité et la limitation de la consommation. La durée high doit être plus grand que la durée durée d'une salve.
		\begin{equation*}
			\begin{cases}
				\tau = 0.693(Rba+2Rbb)Cb \\
				n_{pulse}*\frac{T_0}{\tau} < \frac{Rba+Rbb}{Rba+2Rbb} \\
				Rbl	= \SI{1}{\kilo\ohm}
			\end{cases}
		\end{equation*}
	\item[Logic] Assure les conditions logiques sur les signaux. Il est formée d'un quadruple 2-input NOR HEF4001 \cite{HEF4001B}.
\end{description}

\subsection{LED driver}
\label{subsec:LED_driver}
Le LED driver allume la LED infrarouge lorsque LED\_SIGNAL est high. Il assure une bonne émission de la LED sans l'endommager si le signal de 3V a une période T\_0 avec un duty-cycle de 10\%.

La LED est une LD271(H). Selon son datasheet, celle-ci accepte $\SI{1}{\ampere}$ durant $\SI{0.1}{\milli\second}$ toutes les $\SI{1.0}{\milli\second}$ \cite{LD271(H)}. Ce sont ses valeurs qui ont dicté le choix du signal. Le courant est limité par la résistance $R14 = \SI{1}{\ohm}$ et une grande capacité de découplage $C7=\SI{470}{\micro F}$ assure la puissance de l'émission.


\todo[inline]{check active high/low}

\subsection{Récepteur et filtrage}
\todo[inline]{blabla on frequencies + dimension RC}
\begin{description}[leftmargin=!,labelwidth=5cm, labelindent=\parindent]
	\item[Conversion \& low-pass] Convertit le petit courant de la diode en tension tout en appliquant un filtre passe-bas.
	\item[Amplification \& high-pass] Amplifie la tension tout en appliquant un filtre passe-haut.
	\item[Schmidt trigger] Génère un signal carré avec 2 seuils en tension: $V_+$ et $V_-$
\end{description}

\subsection{Décodeur}
Le décodeur à 3 fonctions:

\begin{description}[leftmargin=!,labelwidth=4cm, labelindent=\parindent]
	\item[Decounter] Signal si $n_{pulse}$ ont été reçus par la tension d'entrée depuis son dernier RESET.
	\item[Missing pulse detector] Signal et reset le decounter après un certain délais si la tension d'entrée est maintenue \emph{low} pendant au moins $t_{miss} = xxx \si{\milli\second}$ après la fin d'un pulse.
	\item[Logic] Met OUTPUT à high si les conditions d'une salve correcte sont remplie. Si $n_{pulse}$ impulsions ont été reçues et que une impulsion manquante est signalée, alors OUTPUT est mis à high. 
\end{description}

\begin{center}
    \begin{tabular}{| m{4cm} | m{4cm} | l | c |}
        \hline
    % \thead{\emph{Missing pulse detector}} & \thead{\emph{Decounter}} & \thead{Statu}} & \thead{Sortie}}\ \hline
    % \thead{\emph{Missing pulse detector}} & \thead{\emph{Decounter}} & \thead{Statu} & \thead{Sortie}\\ \hline
        low     & low       & Nombre incorrect de pulses dans la salve & low \\ \hline
        low     & high  & Salve correcte    & high\\ \hline
        high    & low       & Salve non finie & low \\ \hline
        high    & high  & Salve non finie & low \\ \hline
    \end{tabular}
\end{center}

\subsection{Sortie}

\subsubsection{Détecteur de pause}
\todo[inline]{pause = lâchement de bouton, comment on veut nommer cette partie? -> Déclencheur?}

\subsubsection{Commutation de la sortie}
\subsubsection{Relais}
Le relais optique est simulé par une LED rouge standard avec un courant de 20mA et une tension directe d'environ 1.8V.
Pour alimenter la LED on a choisi le transistor bipolaire NPN BC107 avec une résistance en série pour limiter le courant.
Le BC107 a une tension \(V_{CEsat}\) de 0.25V pour un courant de 10mA.
En estimant une \(V_{CEsat}\) de 0.30V pour un courant de 20mA:
\[
R_{LED} = (5V - V_{CEsat} - V_{forward})/20mA = 145\Omega
\]
On choisit donc \(150\Omega\).

\subsection{Mesures}

Dans figure \ref{fig:decoder_signal} on voit le fonctionnement du détecteur avec différent nombres de pulses.
Dans la mesure au milieu le décodeur détecté correctement les 13 pulses et la combinaison logique
du signal du détecteur de pulse manquant et du compteur de pulses donne un signal de sortie (en vert).
Dans le cas où le mauvais nombre  de pulses (12 pulese dans la mesrue à gauche et 14 pulese à droite)
arrive à l'entrée il n'y a pas de signal à la sortie.

\begin{figure}[h]
\centering
\includegraphics[width=0.3\textwidth]{../measurements/SCR06}
\includegraphics[width=0.3\textwidth]{../measurements/SCR07}
\includegraphics[width=0.3\textwidth]{../measurements/SCR08}
\caption{
\textcolor{yellow}{$\blacksquare$} Signal d'entrée,
\textcolor{blue}{$\blacksquare$} Détecteur de pulse manquant,
\textcolor{magenta}{$\blacksquare$} Compteur de pulse,
\textcolor{green}{$\blacksquare$} Sortie
}
\label{fig:decoder_signal}
\end{figure}

\begin{figure}[h]{}
\centering
\includegraphics[width=0.3\textwidth]{../measurements/SCR12}
\caption{
\textcolor{yellow}{$\blacksquare$} Signal d'entrée,
\textcolor{blue}{$\blacksquare$} Capacité sur bascule monostable,
\textcolor{magenta}{$\blacksquare$} Sortie du détecteur de pause,
\textcolor{green}{$\blacksquare$} Sortie
}
\label{fig:output_signal}
\end{figure}

\section{Annexes}


\begin{thebibliography}{9}

	\bibitem{LD271(H)}
	OSRAM,
	\textit{LD271 - HGaAs Infrared Emitter},
	Version 1.0,
	4 Avril 2007,
	\url{http://www.osram-os.com/Graphics/XPic5/00082753_0.pdf/LD%20271,%20Lead%20(Pb)%20Free%20Product%20-%20RoHS%20Compliant.pdf}

		\bibitem{BP104}
		VISHAY,
		\textit{BP104 - Silicon PIN Photodiode},
		Revision: 08-Feb-17,
		\url{http://www.vishay.com/docs/81500/81500.pdf}

		\bibitem{TLC555}
		TEXAS INSTRUMENTS,
		\textit{TLC555 LinCMOS\texttrademark Timer},
		REVISED AUGUST 2016,
		SEPTEMBER 1983,
		\url{http://www.ti.com/lit/ds/symlink/tlc555.pdf}

		\bibitem{HEF4526B}
		NXP,
		\textit{HEF4526B - Programmable 4-bit binary down counter - Product data sheet},
		Rev. 5,
		22 November 2011,
		\url{http://www.nxp.com/documents/data_sheet/HEF4526B.pdf}.

		\bibitem{HEF4001B}
		NXP,
		\textit{HEF4001B - Quad 2-input NOR gate - Product data sheet},
		Rev. 10,
		10 December 2015,
		\url{https://assets.nexperia.com/documents/data-sheet/HEF4001B.pdf}

\end{thebibliography}


\end{document}
